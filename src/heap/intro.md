- [Setup](#setup)
  - [malloc_playground](#malloc_playground)
  - [Pwndbg](#pwndbg)
  - [Villoc + DynamoRIO](#villoc--dynamorio)
- [Teoria](#teoria)
# Setup
## malloc_playground
`git clone https://github.com/shellphish/how2heap.git`

## Pwndbg
- gdb base: `sudo apt-get install gdb`
- e os coisos de teste: `sudo apt-get install libc6-dbg libc6-dbg:i386 libc6-dbg:amd64` caso voce tambem queira arm, mips, sei la,....

- [Github: pwndbg](https://github.com/pwndbg/pwndbg)
- ou [Github: gdb-peda-pwndbg-gef ](https://github.com/apogiatzis/gdb-peda-pwndbg-gef)

## Villoc + DynamoRIO
- [Github: DynamoRIO](https://github.com/DynamoRIO/dynamorio/releases) Ai voce baixa a versão mais recente pra sua plataforma.
- [Github: Villoc](https://github.com/wapiflapi/villoc/tree/master/tracers/dynamorio) e aqui as instruções para usar DynamoRIO

Mas resumindo, voce baixa o `tar` do DynamoRIO, extrai em `/usr/bin` ou `local`,... ou onde voce preferir

E executa `export DYNAMORIO_HOME=/usr/bin/DynamoRIO/`

Ai voce baixa `sudo apt-get install cmake`

Em seguida voce baixa villoc usando `git` e executa 
```bash
git clone https://github.com/wapiflapi/villoc.git
cd villoc/tracers/dynamorio
./build.sh
```

Para usar usar basta substituir `./target` pelo programa e `bin64` por `bin32` caso necessário!
```
$DYNAMORIO_HOME/bin64/drrun  -c villoc_tracer villoc.trace -- ./target

villoc.py villoc.trace out.html
```
Se voce mudou o local do villoc, voce tambem precisara mudar `villoc_tracer` para `/usr/bin/villoc/tracers/dynamorio/villoc_tracer` (com o local certo)

eu recomendo alterar o seu `.bashrc` para facilitar :D
```bash
PATH="$PATH:/usr/bin/villoc"
export DYNAMORIO_HOME=/usr/bin/DynamoRIO/

villoc() {
	$DYNAMORIO_HOME/bin64/drrun  -c /usr/bin/villoc/tracers/dynamorio/villoc_tracer villoc.trace -- $1
	villoc.py villoc.trace $1-villoc.html
	firefox a-villoc.html
}

```
# Teoria
- [1996: Doug Lea - A Memory Allocator](http://gee.cs.oswego.edu/dl/html/malloc.html)
- [dhavalkapil: Heap Exploitation book](https://heap-exploitation.dhavalkapil.com/)
- [SploitFUN: sbrk](https://sploitfun.wordpress.com/2015/02/11/syscalls-used-by-malloc/) 
- [SploitFUN: Malloc](https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/) 
- [GNU: malloc hooks](https://www.gnu.org/software/libc/manual/html_node/Hooks-for-Malloc.html)
- [man: __malloc_hook](https://linux.die.net/man/3/__malloc_hook)
- [stackoverflow: Is there a way to redefine malloc at link time on Windows?](https://stackoverflow.com/questions/120627/is-there-a-way-to-redefine-malloc-at-link-time-on-windows)